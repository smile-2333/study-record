#+TITLE: charles
#+STARTUP: indent
* http
* https
1. help-->ssl proxying-->install charles root certificate
2. 安装到受信任的根证书颁发机构
3. ssl proxying setting控制对哪些域名进行https代理或者全局https代理(单个代理设置对应host/域名和port，全局代理设置*:443)
* 弱网测试
proxy-->throttle setting

* Mobile device/remote browser
安卓7.0及以上系统对于证书的安全策略做了修改，用户证书只能用于代理浏览器的流量，而应用是不会信任这些证书。【ios和安卓<7.0的版本没有此问题】

下载charles证书，电脑端浏览器输入chls.pro/ssl即可下载，如果未下载也可以在charles>>help>>SSL Proxying>>Save Charles Root Certificate保存证书到本地文件夹
openssl x509 -subject_hash_old -in <证书文件> | head -1
用上述运行结果作为证书的改名，同时后缀改为0
adb连接手机，将文件复制到/system/etc/security/cacerts/，并chmod 644，如果无法复制则mount -o rw,remount /，重复上述步骤直至成功，重启，可以抓取到部分https，其他的根据条件做类似处理
charles-->proxy-->ssl proxy setting，设置location*:443, *:*
* 接口测试
repeat 重复申请请求
compose 对请求编辑后在发出
* Map
** Remote
重定向到指定host:port，在将已上线的web前端，完全从本地服务器取数据时有用
** Locale
重定向到本地文件，针对单个部分的显示效果，多用于做数据mock
** Breakpoint
拦截请求与响应，可修改请求与响应
* program
用Charles抓取SpringBoot各个微服务之间的http调用，
1. 配置_JAVA_OPTIONS环境变量，虚拟机启动时会读取该环境变量进行运行，可以在此处设置代理服务器为Charles开启的端口(默认为8888), -DproxySet=true -DproxyHost=127.0.0.1 -DproxyPort=8888
2. 启动服务器，请求抓包确认
* ref
https://blog.devtang.com/2015/11/14/charles-introduction/
https://www.charlesproxy.com/documentation/
* 激活
https://www.zzzmode.com/mytools/charles/