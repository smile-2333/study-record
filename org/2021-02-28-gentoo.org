#+TITLE: gentoo
#+STARTUP: indent
* install 
#+BEGIN_SRC bash
rc-service sshd start

# 分区+设置文件系统
parted -a optimal /dev/sda
mklabel gpt
unit mib
mkpart primary 1 3
name 1 grub
set 1 bios_grub on
mkpart primary 3 131
name 2 boot
mkpart primary 131 643
name 3 swap
mkpart primary 643 -1
name 4 rootfs
set 2 boot on
quit
mkfs.ext2 /dev/sda2
mkfs.ext4 /dev/sda4
mkswap /dev/sda3
swapon /dev/sda3

# 挂载rootfs并设置系统相关设置，如mirror和user和编译选项等
ntpd -q -g
mount /dev/sda4 /mnt/gentoo
tar xpvf stage3-*.tar.xz --xattrs-include='*.*' --numeric-owner
echo MAKEOPTS="-j4" >> /mnt/gentoo/etc/portage/make.conf
mirrorselect -i -o >> /mnt/gentoo/etc/portage/make.conf # 阿里的或者163
mkdir --parents /mnt/gentoo/etc/portage/repos.conf
cp /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf

# 把引用挂进去，chroot进去
cp --dereference /etc/resolv.conf /mnt/gentoo/etc/
mount --types proc /proc /mnt/gentoo/proc
mount --rbind /sys /mnt/gentoo/sys
mount --make-rslave /mnt/gentoo/sys
mount --rbind /dev /mnt/gentoo/dev
mount --make-rslave /mnt/gentoo/dev
chroot /mnt/gentoo /bin/bash
source /etc/profile
export PS1="(chroot) ${PS1}"
mount /dev/sda2 /boot # 挂sda2挂进来

emerge-webrsync

# 选profile
# 更新

# 时区配置
echo "Asia/Shanghai" > /etc/timezone
emerge --config sys-libs/timezone-data

# 国际化
env-update && source /etc/profile && export PS1="(chroot) ${PS1}"

emerge --ask sys-kernel/gentoo-sources
emerge --ask sys-kernel/genkernel
nano -w /etc/fstab
/dev/sda2	/boot	ext2	defaults	0 2
genkernel all
#+END_SRC
